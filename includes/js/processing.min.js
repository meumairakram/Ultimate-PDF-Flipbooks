(function InitProcessor(n){if(n.exHelp==void 0||n.exHelpExtend==void 0||n.exHelp.e==void 0)return setTimeout(InitProcessor,100,n);var t=exHelp,i={processing:{progress_max:-1,progress_now:0,progress_page:0,progress_mode:"render",path:null,canvas:null,preview_image:null,current_script:null,elements:[{selector:".generator",options:{"class":"generator"},children:[{selector:".title",options:{"class":"title",html:"__LOCALE__:PROCESSING_TITLE"}},{selector:".text",options:{"class":"text",html:"__LOCALE__:PROCESSING_TEXT"}},{selector:".progress",options:{"class":"progress indeterminate"},children:[{selector:".bar",options:{"class":"bar"}}]},{selector:".info",options:{"class":"info",html:"__LOCALE__:PROCESSING_INIT"}}]}],pdf_exists:!1,pdf_checked:!1,pdf_checking:!1,pdf_enabled:!1,pdf_preparing:!1,pdf_loaded:!1,pdf_loaded_load:!1,pdf_loaded_progess:!1,data:{cover_small:null,cover_medium:null,cover_big:null,cover_retina:null,json:null,pages:null},working:!1,init:function(n){console.log(n);this.path=n;this.preparePdf();t.e(".status").addClass("gone");this.prepareElements()},prepareElements:function(){var n=t.processing,u,r,i,f;for(u in n.elements)t.reader._prepareElement(n.elements[u],t.reader.container);r=t.e(".content .pages");r.addClass("single");i=t.e("<div>",{"class":"page",style:"width: 100%; height: 100%;"});f=t.e("<div>",{"class":"wrapper"}).appendTo(i);n.preview_image=t.e("<img>").appendTo(f);n.canvas=t.e("<canvas>");n.canvas.appendTo(i);i.appendTo(r)},setProgress:function(n,i){var r=t.e(".generator .progress"),u=t.e(".generator .progress .bar"),f=t.e(".generator .info");t.is.number(n)?(parseInt(n)>=0?(u.setStyle("width",n+"%"),r.removeClass("indeterminate")):(u.setStyle("width",""),r.addClass("indeterminate")),i&&f.setHtml(i)):t.is.string(n)&&f.setHtml(n)},start_processing:function(){var n=t.processing;if(!n.working){n.working=!0;n.setProgress(-1,t.locale.getString("PROCESSING_PREPARING").format(t.PDFManager.document.numPages));var i=1;n.progress_max=t.PDFManager.document.numPages*(5+i)+4*(1+i);n.progress_now=0;n.progress_page=0;n.progress_mode="render";t.PDFManager.scale=2;n.data={cover_small:null,cover_medium:null,cover_big:null,cover_retina:null,json:{},pages:{}};n.processing_step()}},downScaleImage:function(n,t){var i=document.createElement("canvas"),r;return i.width=n.width,i.height=n.height,r=i.getContext("2d"),r.drawImage(n,0,0),this.downScaleCanvas(i,t)},downScaleCanvas:function(n,t){var b;if(!(t<1)||!(t>0))throw"scale must be a positive number <1 ";for(var ft=t*t,et=n.width,ot=n.height,f=Math.floor(et*t),k=Math.floor(ot*t),d=0,g=0,c=0,l=0,a=0,ht=0,i=0,v=0,y=0,e=0,u=0,nt=0,tt=0,it=0,rt=0,p=!1,w=!1,st=n.getContext("2d").getImageData(0,0,et,ot).data,r=new Float32Array(3*f*k),o=0,s=0,h=0,g=0;g<ot;g++)for(a=g*t,y=0|a,ht=3*y*f,w=y!=(0|a+t),w&&(it=y+1-a,rt=a+t-y-1),d=0;d<et;d++,c+=4)l=d*t,v=0|l,i=ht+v*3,p=v!=(0|l+t),p&&(nt=v+1-l,tt=l+t-v-1),o=st[c],s=st[c+1],h=st[c+2],p||w?p&&!w?(e=nt*t,r[i]+=o*e,r[i+1]+=s*e,r[i+2]+=h*e,u=tt*t,r[i+3]+=o*u,r[i+4]+=s*u,r[i+5]+=h*u):w&&!p?(e=it*t,r[i]+=o*e,r[i+1]+=s*e,r[i+2]+=h*e,u=rt*t,r[i+3*f]+=o*u,r[i+3*f+1]+=s*u,r[i+3*f+2]+=h*u):(e=nt*it,r[i]+=o*e,r[i+1]+=s*e,r[i+2]+=h*e,u=tt*it,r[i+3]+=o*u,r[i+4]+=s*u,r[i+5]+=h*u,u=nt*rt,r[i+3*f]+=o*u,r[i+3*f+1]+=s*u,r[i+3*f+2]+=h*u,u=tt*rt,r[i+3*f+3]+=o*u,r[i+3*f+4]+=s*u,r[i+3*f+5]+=h*u):(r[i]+=o*ft,r[i+1]+=s*ft,r[i+2]+=h*ft);b=document.createElement("canvas");b.width=f;b.height=k;var ct=b.getContext("2d"),lt=ct.getImageData(0,0,f,k),ut=lt.data,at=0;for(c=0,i=0;at<f*k;c+=3,i+=4,at++)ut[i]=Math.ceil(r[c]),ut[i+1]=Math.ceil(r[c+1]),ut[i+2]=Math.ceil(r[c+2]),ut[i+3]=255;return ct.putImageData(lt,0,0),b},resize:function(n,t){var i=t.width/n.naturalWidth;return this.downScaleImage(n,i)},processing_step:function(){var i=t.processing;console.log("Processing Step");i.working&&(i.progress_mode=="render"?i.progress_page<t.PDFManager.document.numPages?(i.progress_page++,i.processing_increment_progress(),t.PDFManager.renderPageOn(i.progress_page,i.canvas,function(){var n=new Image;n.src=i.canvas[0].toDataURL();n.onload=function(){var u,r,f,e;i.data.pages[i.progress_page]={full:i.canvas[0].toDataURL("image/jpeg",.85),thumb:null};i.processing_increment_progress();u=n.naturalHeight/n.naturalWidth;r={width:100,height:100*u};i.progress_page==1&&(i.data.cover_big=i.canvas[0].toDataURL("image/jpeg",.85),i.processing_increment_progress(),f={width:r.width*2,height:r.height*2},e={width:r.width*3,height:r.height*3},i.data.cover_retina=i.resize(n,e).toDataURL("image/jpeg",.85),i.processing_increment_progress(),i.data.cover_medium=i.resize(n,f).toDataURL("image/jpeg",.85),i.processing_increment_progress(),i.data.cover_small=i.resize(n,r).toDataURL("image/jpeg",.85),i.processing_increment_progress());i.data.pages[i.progress_page].thumb=i.resize(n,r).toDataURL("image/jpeg",.85);i.processing_increment_progress();t.PDFManager.getPage(i.progress_page,function(r){r.getTextContent().then(function(r){for(var f,e=[],u=0;u<r.items.length;u++)f=""+r.items[u].str.trim(),f.length>0&&e.push(f);i.data.json[i.progress_page]={page_content:t.utf8_encode(e.join(" ")),ref_size:{width:n.naturalWidth,height:n.naturalHeight}};i.processing_increment_progress();i.processing_step()})})}},!0)):(i.progress_mode="upload",i.progress_page=0,i.processing_step()):i.progress_mode=="upload"&&(i.progress_page<t.PDFManager.document.numPages?(i.progress_page++,i.processing_increment_progress_upload(),i.progress_page==1?t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"page",transfer:"base64",file:i.data.pages[i.progress_page].full,page:i.progress_page},finished:function(){i.processing_increment_progress_upload();t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"thumb",transfer:"base64",file:i.data.pages[i.progress_page].thumb,page:i.progress_page},finished:function(){i.processing_increment_progress_upload();t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"cover_small",transfer:"base64",file:i.data.cover_small},finished:function(){i.processing_increment_progress_upload();t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"cover_medium",transfer:"base64",file:i.data.cover_medium},finished:function(){i.processing_increment_progress_upload();t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"cover_retina",transfer:"base64",file:i.data.cover_retina},finished:function(){i.processing_increment_progress_upload();t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"cover_big",transfer:"base64",file:i.data.cover_big},finished:function(){i.processing_step()}})}})}})}})}})}}):t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"page",transfer:"base64",file:i.data.pages[i.progress_page].full,page:i.progress_page},finished:function(){i.processing_increment_progress_upload();t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"thumb",transfer:"base64",file:i.data.pages[i.progress_page].thumb,page:i.progress_page},finished:function(){i.processing_step()}})}})):t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"upload",type:"json",transfer:"base64",file:"data:application/json;base64,"+btoa(t.jsonStringify(i.data.json))},finished:function(){i.processing_increment_progress_upload();i.setProgress(-1,"AufrÃ¤umen...");t.net.request(i.path+"/upload.php",{method:"POST",data:{cmd:"cleanup"},finished:function(){i.setProgress(100,t.locale.getString("PROCESSING_FINISHED"));n.location.reload()}})}})))},processing_increment_progress:function(){var n=t.processing;n.setProgress(t.math.Percentage.XofY(n.progress_now++,n.progress_max),t.locale.getString("PROCESSING_WORKING").format(n.progress_page,t.PDFManager.document.numPages))},processing_increment_progress_upload:function(){var n=t.processing;n.setProgress(t.math.Percentage.XofY(n.progress_now++,n.progress_max),t.locale.getString("PROCESSING_UPLOADING").format(n.progress_page,t.PDFManager.document.numPages))},preparePdf:function(){var n=t.processing;n.setProgress(-1,t.locale.getString("PROCESSING_PREP"));n.pdf_checked||n.pdf_checking||(n.pdf_checking=!0,t.net.request(n.path+"/upload.php",{method:"POST",data:{cmd:"prepare"},finished:function(i,r){i?r.trim()=="ok"?t.net.request(n.path+"/full.pdf",{method:"HEAD",finished:function(t){n.pdf_exists=t;n.pdf_checked=!0;n.pdf_checking=!1;t&&(n.pdf_preparing=!0,n.preparePdfJs())}}):r.trim()=="nopdf"?t.reader.makeMessage(t.locale.getString("ERROR_TITLE"),t.locale.getString("ERROR_NO_PDF")).appendTo(n.container):t.reader.makeMessage(t.locale.getString("ERROR_TITLE"),t.locale.getString("ERROR_UPLOAD_PHP")).appendTo(n.container):t.reader.makeMessage(t.locale.getString("ERROR_TITLE"),t.locale.getString("ERROR_UPLOAD_PHP")).appendTo(n.container)}}))},preparePdfJs:function(){var n=t.processing,r=t.e("script"),i=null;r.each(function(){if(this.src.contains("magalone."))return i=this.src,!1});i!=null&&(n.current_script=i,n.loadPdfJsCompat(function(){n.loadPdfJsMain(function(){n.pdf_preparing=!1;n.pdf_enabled=!0;t.PDFManager.setOnDocumentLoadHandler(n.pdfJsOnLoad);t.PDFManager.setOnDocumentProgressHandler(n.pdfJsOnProgress);t.PDFManager.setOnPageLoadHandler(n.pdfJsOnPage);t.PDFManager.setOnPageRenderHandler(n.pdfJsOnRender);t.PDFManager.loadFile(n.path+"/full.pdf")})}))},loadPdfJsCompat:function(n){var i=t.processing,f=i.current_script.substr(0,i.current_script.lastIndexOf("/")),e=f+"/pdfjs/compatibility"+(i.current_script.contains(".min")?".min":"")+".js",r=document.createElement("script"),u=!1;r.onload=function(){u||n();u=!0};r.setAttribute("src",e);document.getElementsByTagName("head")[0].appendChild(r)},loadPdfJsMain:function(n){var i=t.processing,f=i.current_script.substr(0,i.current_script.lastIndexOf("/")),e=f+"/pdfjs/pdf"+(i.current_script.contains(".min")?".min":"")+".js",r=document.createElement("script"),u=!1;r.onload=function(){u||n();u=!0};r.setAttribute("src",e);document.getElementsByTagName("head")[0].appendChild(r)},pdfJsOnLoad:function(){var n=t.processing;n.pdf_loaded_load=!0;n.pdf_loaded=n.pdf_loaded_load&&n.pdf_loaded_progess;n.pdf_loaded&&n.start_processing()},pdfJsOnProgress:function(n){var i=t.processing,r=t.math.Percentage.XofY(n.loaded,n.total);i.pdf_loaded||i.setProgress(r,t.locale.getString("PROCESSING_PDF").format(r.toFixed(0)));r>=100&&(i.pdf_loaded_progess=!0,i.pdf_loaded=i.pdf_loaded_load&&i.pdf_loaded_progess,i.pdf_loaded&&i.start_processing())},pdfJsOnPage:function(){},pdfJsOnRender:function(){}}};exHelp.extend(i)})(window);

/*

//# sourceMappingURL=processing.min.js.map

*/